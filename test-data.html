<!DOCTYPE html>
<html>
<head>
    <title>Test LocalStorage Data</title>
</head>
<body>
    <h1>Ajouter des donn√©es de test</h1>
    <button onclick="addTestData()">Ajouter des projets et √©quipes de test</button>
    <button onclick="clearData()">Effacer toutes les donn√©es</button>
    <button onclick="simulateLogout()">Simuler d√©connexion</button>
    <button onclick="simulateLogin()">Simuler connexion</button>
    <button onclick="showData()">Afficher les donn√©es</button>
    <button onclick="testDeletion()">Tester suppression synchronis√©e</button>
    <button onclick="testPersistence()">üîÑ Test Persistance Compl√®te</button>
    <button onclick="testDeleteSynchronization()">üóëÔ∏è Test Suppression Synchronis√©e</button>
    <button onclick="initializeUsers()">üë• Initialiser base utilisateurs</button>
    <button onclick="testUserSystem()">üîê Test syst√®me utilisateurs</button>
    <button onclick="resetAll()">üö´ RESET TOTAL - Remettre √† z√©ro</button>
    
    <div id="output"></div>
    
    <script>
        function addTestData() {
            // Simuler une authentification
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('authToken', 'test-token-123');
            
            // Ajouter des projets de test
            const testProjects = [
                {
                    id: 1672531200000,
                    name: "Site Web E-commerce",
                    description: "D√©veloppement d'une plateforme de vente en ligne moderne",
                    dueDate: "2025-02-15",
                    status: "En cours",
                    progress: 65,
                    members: 3,
                    createdAt: "2025-01-01T10:00:00.000Z"
                },
                {
                    id: 1672531260000,
                    name: "Application Mobile",
                    description: "App mobile pour la gestion de t√¢ches collaboratives",
                    dueDate: "2025-03-10",
                    status: "En cours",
                    progress: 30,
                    members: 2,
                    createdAt: "2025-01-01T11:00:00.000Z"
                }
            ];
            
            // Ajouter des √©quipes de test
            const testTeams = [
                {
                    id: 1672531320000,
                    name: "√âquipe D√©veloppement",
                    description: "√âquipe principale de d√©veloppement frontend et backend",
                    visibility: "private",
                    members: 5,
                    role: "Admin",
                    status: "active",
                    createdAt: "2025-01-01T12:00:00.000Z"
                },
                {
                    id: 1672531380000,
                    name: "√âquipe Design",
                    description: "√âquipe cr√©ative pour les interfaces utilisateur",
                    visibility: "public",
                    members: 3,
                    role: "Admin",
                    status: "active",
                    createdAt: "2025-01-01T13:00:00.000Z"
                }
            ];
            
            localStorage.setItem('userProjects', JSON.stringify(testProjects));
            localStorage.setItem('userTeams', JSON.stringify(testTeams));
            
            document.getElementById('output').innerHTML = '<p style="color: green;">Donn√©es de test ajout√©es avec succ√®s! Les projets et √©quipes persisteront m√™me apr√®s d√©connexion.</p>';
        }
        
        function clearData() {
            localStorage.removeItem('userProjects');
            localStorage.removeItem('userTeams');
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('authToken');
            document.getElementById('output').innerHTML = '<p style="color: red;">Toutes les donn√©es ont √©t√© effac√©es!</p>';
        }
        
        function simulateLogout() {
            // Supprimer SEULEMENT les donn√©es d'authentification, pas les projets/√©quipes
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('authToken');
            document.getElementById('output').innerHTML = '<p style="color: orange;">‚úÖ D√©connexion simul√©e - projets et √©quipes restent sauvegard√©s!</p>';
        }
        
        function simulateLogin() {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('authToken', 'test-token-123');
            document.getElementById('output').innerHTML = '<p style="color: blue;">Connexion simul√©e - les donn√©es existantes sont pr√©serv√©es!</p>';
        }
        
        function showData() {
            const projects = localStorage.getItem('userProjects');
            const teams = localStorage.getItem('userTeams');
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            
            let output = '<h3>Donn√©es actuelles:</h3>';
            output += `<p><strong>Connect√©:</strong> ${isLoggedIn || 'Non'}</p>`;
            output += `<p><strong>Projets:</strong> ${projects ? JSON.parse(projects).length : 0}</p>`;
            output += `<p><strong>√âquipes:</strong> ${teams ? JSON.parse(teams).length : 0}</p>`;
            
            if (projects) {
                output += '<h4>Projets:</h4><pre>' + JSON.stringify(JSON.parse(projects), null, 2) + '</pre>';
            }
            
            if (teams) {
                output += '<h4>√âquipes:</h4><pre>' + JSON.stringify(JSON.parse(teams), null, 2) + '</pre>';
            }
            
            document.getElementById('output').innerHTML = output;
        }

        function testDeletion() {
            // D'abord, s'assurer qu'on a des donn√©es de test
            addTestData();
            
            const projects = JSON.parse(localStorage.getItem('userProjects') || '[]');
            const teams = JSON.parse(localStorage.getItem('userTeams') || '[]');
            
            alert(`Test de suppression synchronis√©e:\n\nAvant: ${projects.length} projets, ${teams.length} √©quipes\n\nMaintenant, allez sur /teams et supprimez une √©quipe.\nPuis v√©rifiez sur /projects que l'assignation a √©t√© retir√©e.\nEt sur /dashboard que les statistiques sont mises √† jour.`);
        }

        function testPersistence() {
            // Effacer d'abord toutes les donn√©es
            localStorage.clear();
            
            // Simuler connexion
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('authToken', 'test-token-123');
            
            // Ajouter une √©quipe
            const testTeam = {
                id: Date.now(),
                name: "√âquipe Test Persistance",
                description: "√âquipe pour tester la persistance",
                avatar: "https://ui-avatars.com/api/?name=Test&background=4f46e5&color=fff&size=128",
                members: 1,
                projects: 0,
                department: "Test",
                role: 'Admin',
                status: 'active',
                visibility: 'private',
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userTeams', JSON.stringify([testTeam]));
            
            // Ajouter un projet assign√© √† cette √©quipe
            const testProject = {
                id: Date.now() + 1,
                name: "Projet Test Persistance",
                description: "Projet pour tester la persistance",
                dueDate: "2025-12-31",
                assignedTeam: testTeam.id.toString(),
                assignedTeamName: testTeam.name,
                status: 'En cours',
                progress: 50,
                members: 1,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userProjects', JSON.stringify([testProject]));
            
            alert('‚úÖ Donn√©es de test ajout√©es !\n\nTest de persistance :\n1. Allez sur /projects et /teams - v√©rifiez les donn√©es\n2. Cliquez "Simuler d√©connexion" ci-dessous\n3. Reconnectez-vous\n4. V√©rifiez que tout persiste !');
        }
        
        function testDeleteSynchronization() {
            // Effacer d'abord toutes les donn√©es
            localStorage.clear();
            
            // Simuler connexion
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('authToken', 'test-token-123');
            
            // Cr√©er une √©quipe
            const team1 = {
                id: 1001,
                name: "√âquipe Backend",
                description: "D√©veloppement backend",
                avatar: "https://ui-avatars.com/api/?name=Backend&background=4f46e5&color=fff&size=128",
                members: 3,
                projects: 0,
                department: "D√©veloppement",
                role: 'Admin',
                status: 'active',
                visibility: 'private',
                createdAt: new Date().toISOString()
            };
            
            const team2 = {
                id: 1002,
                name: "√âquipe Frontend",
                description: "D√©veloppement frontend",
                avatar: "https://ui-avatars.com/api/?name=Frontend&background=e11d48&color=fff&size=128",
                members: 2,
                projects: 0,
                department: "D√©veloppement",
                role: 'Admin',
                status: 'active',
                visibility: 'private',
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userTeams', JSON.stringify([team1, team2]));
            
            // Cr√©er des projets assign√©s √† diff√©rentes √©quipes
            const projects = [
                {
                    id: 2001,
                    name: "API REST",
                    description: "D√©veloppement de l'API REST",
                    dueDate: "2025-12-31",
                    assignedTeam: "1001",
                    assignedTeamName: "√âquipe Backend",
                    status: 'En cours',
                    progress: 60,
                    members: 3,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2002,
                    name: "Interface utilisateur",
                    description: "D√©veloppement de l'interface",
                    dueDate: "2025-11-30",
                    assignedTeam: "1002",
                    assignedTeamName: "√âquipe Frontend",
                    status: 'En cours',
                    progress: 40,
                    members: 2,
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2003,
                    name: "Base de donn√©es",
                    description: "Configuration de la base de donn√©es",
                    dueDate: "2025-10-15",
                    assignedTeam: "1001",
                    assignedTeamName: "√âquipe Backend",
                    status: 'En cours',
                    progress: 80,
                    members: 1,
                    createdAt: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('userProjects', JSON.stringify(projects));
            
            alert('‚úÖ Donn√©es de test pour suppression synchronis√©e !\n\nTest :\n1. Allez sur /projects - 3 projets\n2. Allez sur /teams - 2 √©quipes\n3. Supprimez "√âquipe Backend"\n4. Retournez sur /projects\n5. Les projets assign√©s devraient √™tre supprim√©s !');
        }

        function initializeUsers() {
            // Base d'utilisateurs
            const users = [
                {
                    id: 'user_001',
                    firstName: 'Alice',
                    lastName: 'Martin',
                    email: 'alice.martin@company.com',
                    avatar: 'https://ui-avatars.com/api/?name=Alice+Martin&background=4f46e5&color=fff&size=128',
                    department: 'D√©veloppement',
                    role: 'Admin',
                    status: 'active',
                    createdAt: '2025-01-01T00:00:00.000Z'
                },
                {
                    id: 'user_002',
                    firstName: 'Bob',
                    lastName: 'Dupont',
                    email: 'bob.dupont@company.com',
                    avatar: 'https://ui-avatars.com/api/?name=Bob+Dupont&background=e11d48&color=fff&size=128',
                    department: 'Design',
                    role: 'Manager',
                    status: 'active',
                    createdAt: '2025-01-02T00:00:00.000Z'
                },
                {
                    id: 'user_003',
                    firstName: 'Claire',
                    lastName: 'Bernard',
                    email: 'claire.bernard@company.com',
                    avatar: 'https://ui-avatars.com/api/?name=Claire+Bernard&background=10b981&color=fff&size=128',
                    department: 'Marketing',
                    role: 'Member',
                    status: 'active',
                    createdAt: '2025-01-03T00:00:00.000Z'
                },
                {
                    id: 'user_004',
                    firstName: 'David',
                    lastName: 'Leroy',
                    email: 'david.leroy@company.com',
                    avatar: 'https://ui-avatars.com/api/?name=David+Leroy&background=f59e0b&color=fff&size=128',
                    department: 'D√©veloppement',
                    role: 'Member',
                    status: 'active',
                    createdAt: '2025-01-04T00:00:00.000Z'
                }
            ];
            
            localStorage.setItem('usersDatabase', JSON.stringify(users));
            document.getElementById('output').innerHTML = '<p style="color: green;">‚úÖ Base d\'utilisateurs initialis√©e ! 4 utilisateurs disponibles.</p>';
        }

        function testUserSystem() {
            // Effacer toutes les donn√©es
            localStorage.clear();
            
            // Initialiser la base d'utilisateurs
            initializeUsers();
            
            // Simuler connexion avec Alice
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('authToken', 'token_user_001_' + Date.now());
            localStorage.setItem('currentUserId', 'user_001');
            localStorage.setItem('userEmail', 'alice.martin@company.com');
            localStorage.setItem('userName', 'Alice Martin');
            
            // Cr√©er une √©quipe pour Alice
            const team = {
                id: Date.now(),
                name: "√âquipe Alice",
                description: "√âquipe de d√©veloppement dirig√©e par Alice",
                ownerId: 'user_001',
                members: ['user_001'], // Alice est membre de sa propre √©quipe
                avatar: 'https://ui-avatars.com/api/?name=√âquipe+Alice&background=4f46e5&color=fff&size=128',
                department: 'D√©veloppement',
                role: 'Admin',
                status: 'active',
                visibility: 'private',
                projects: 0,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userTeams', JSON.stringify([team]));
            
            // Cr√©er un projet pour Alice
            const project = {
                id: Date.now() + 1,
                name: "Projet Alice",
                description: "Projet personnel d'Alice",
                dueDate: "2025-12-31",
                assignedTeam: team.id.toString(),
                assignedTeamName: team.name,
                ownerId: 'user_001',
                status: 'En cours',
                progress: 25,
                members: 1,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('userProjects', JSON.stringify([project]));
            
            alert('‚úÖ Syst√®me utilisateurs configur√© !\n\nConnect√© en tant que : Alice Martin\n\nTest :\n1. Allez sur /projects - vous verrez le projet d\'Alice\n2. Allez sur /teams - vous verrez l\'√©quipe d\'Alice\n3. D√©connectez-vous et reconnectez-vous avec bob.dupont@company.com\n4. Vous ne verrez pas les donn√©es d\'Alice !');
        }

        function resetAll() {
            // Supprimer TOUTES les donn√©es localStorage
            localStorage.clear();
            
            // Confirmer la suppression
            const confirmReset = confirm('‚ö†Ô∏è ATTENTION !\n\nCette action va supprimer TOUTES les donn√©es :\n- Base d\'utilisateurs\n- Projets\n- √âquipes\n- Sessions\n- Invitations\n\n√ätes-vous s√ªr de vouloir continuer ?');
            
            if (confirmReset) {
                // Tout est d√©j√† supprim√© avec localStorage.clear()
                document.getElementById('output').innerHTML = `
                    <div style="background: #fee; border: 1px solid #f00; padding: 15px; border-radius: 5px; margin: 10px 0;">
                        <h3 style="color: #c00; margin: 0 0 10px 0;">üö´ RESET TOTAL EFFECTU√â</h3>
                        <p style="margin: 5px 0;"><strong>‚úÖ Base d'utilisateurs :</strong> Supprim√©e</p>
                        <p style="margin: 5px 0;"><strong>‚úÖ Projets :</strong> Supprim√©s</p>
                        <p style="margin: 5px 0;"><strong>‚úÖ √âquipes :</strong> Supprim√©es</p>
                        <p style="margin: 5px 0;"><strong>‚úÖ Sessions :</strong> Supprim√©es</p>
                        <p style="margin: 5px 0;"><strong>‚úÖ Invitations :</strong> Supprim√©es</p>
                        <hr style="margin: 15px 0;">
                        <p style="color: #666;">Vous pouvez maintenant recommencer les tests depuis z√©ro !</p>
                        <p style="color: #666;">Suggestions :</p>
                        <ol style="color: #666; margin: 10px 0;">
                            <li>Cliquez "üë• Initialiser base utilisateurs"</li>
                            <li>Puis "üîê Test syst√®me utilisateurs"</li>
                            <li>Ou utilisez les autres fonctions de test</li>
                        </ol>
                    </div>
                `;
                
                console.log('üö´ RESET TOTAL - Toutes les donn√©es ont √©t√© supprim√©es');
                
                // V√©rification que tout est bien supprim√©
                const remainingKeys = Object.keys(localStorage);
                if (remainingKeys.length === 0) {
                    console.log('‚úÖ Confirmation : localStorage est compl√®tement vide');
                } else {
                    console.warn('‚ö†Ô∏è Il reste des cl√©s dans localStorage :', remainingKeys);
                }
            } else {
                document.getElementById('output').innerHTML = '<p style="color: #666;">‚ùå Reset annul√© - aucune donn√©e supprim√©e.</p>';
            }
        }
    </script>
</body>
</html>
